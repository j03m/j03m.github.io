<h1 id="this-blog-wrote-itself-">THIS BLOG WROTE ITSELF!</h1>
<p>Well, no it didn&#39;t. But this blog for all intents an purposes created by the
tools it aims to describe and serves as an outline as to how a server-less blog
can be created using github.io for hosting, nodejs and gulp.</p>
<p>I immediately dug the instantness of github.io. Being pretty bare bones though
I was initially woed by Jekyll. About a quarter of the way into the instructions
though, I found myself saying. You know what - you&#39;ve done so little web stuff
in recent days. Why don&#39;t you take a moment and build it out yourself?</p>
<p>The first thing I knew is I wanted to write in my editor of choice using
Markdown because, well, Markdown is fast, fluent, easy and we all know it well
from creating github README.mds. I had no interest in web based editors. I tried
Medium and couldn&#39;t figure out a way to format a code snippet that could compete
with Github&#39;s very simple &amp;#96&amp;#96&amp;#96javascript.</p>
<p>I also wanted the site to be pretty and have some neat features that I could
code myself. This would also (in theory) allow me to build the scaffolding of
the site to taste, force me to brush up my CSS skills and generally let me have
a place to drop new client side web tech without much overhead. (I&#39;m sure at
some point I&#39;ll need a server, but we&#39;ll see).</p>
<p>I also didn&#39;t want to host a backend and I want to push and revise content in git.
Obviously github.io is the perfect fit, but I wanted to build up a scaffolding
that let me publish as easily as deploying code. I also wanted to be able to
save drafts and review them locally before pushing.</p>
<p>The plan seemed simple: Create a set of gulp scripts that converted md files to blog posts.
Host the blog locally so I could see live updates and use git to manage version. What could go wrong?</p>
<p>So the first post in this blog is how I built this blog. One of my favorite
blog of all time both for content, layout and style is <a href="www.substack.net">www.substack.net</a>
(which is also gitpowered, but I still want to write my own), so I&#39;ll pattern off of
that for general usability and coolness. (Imitation is the the most sincere form of flattery?)
We&#39;ll have a scrolling lists of posts and click through to view the full post.</p>
<p>So off to the races.</p>
<h2 id="first-things-first-easy-markdown-to-html-">First things first: <em>Easy markdown to html</em></h2>
<p>(<a href="https://github.com/chjj/marked)[chjj/marked">https://github.com/chjj/marked)[chjj/marked</a>] stood out here
as my best option for node as the syntax highlighting sample was simple to follow
and if I don&#39;t have syntax hilighting then I know down the line I&#39;m going to be
sad.</p>
<p>(I guess we&#39;ll put that to the test now, with a github style code bracket)</p>
<p>First we install some prereqs and end up with an already impressively long
package.json:</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;j03m.github.io&quot;</span><span class="p">,</span>
  <span class="s2">&quot;version&quot;</span><span class="o">:</span> <span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
  <span class="s2">&quot;description&quot;</span><span class="o">:</span> <span class="s2">&quot;J03m&#39;s blog. &quot;</span><span class="p">,</span>
  <span class="s2">&quot;main&quot;</span><span class="o">:</span> <span class="s2">&quot;index.html&quot;</span><span class="p">,</span>
  <span class="s2">&quot;scripts&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;test&quot;</span><span class="o">:</span> <span class="s2">&quot;none&quot;</span>
  <span class="p">},</span>
  <span class="s2">&quot;repository&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;git&quot;</span><span class="p">,</span>
    <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;https://github.com/j03m/j03m.github.io&quot;</span>
  <span class="p">},</span>
  <span class="s2">&quot;keywords&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="s2">&quot;j03m&quot;</span>
  <span class="p">],</span>
  <span class="s2">&quot;author&quot;</span><span class="o">:</span> <span class="s2">&quot;j03m&quot;</span><span class="p">,</span>
  <span class="s2">&quot;license&quot;</span><span class="o">:</span> <span class="s2">&quot;MIT&quot;</span><span class="p">,</span>
  <span class="s2">&quot;bugs&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;url&quot;</span><span class="o">:</span> <span class="s2">&quot;https://github.com/j03m/j03m.github.io/issues&quot;</span>
  <span class="p">},</span>
  <span class="s2">&quot;homepage&quot;</span><span class="o">:</span> <span class="s2">&quot;https://github.com/j03m/j03m.github.io&quot;</span><span class="p">,</span>
  <span class="s2">&quot;dependencies&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;bluebird&quot;</span><span class="o">:</span> <span class="s2">&quot;^2.9.24&quot;</span><span class="p">,</span>
    <span class="s2">&quot;marked&quot;</span><span class="o">:</span> <span class="s2">&quot;^0.3.3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;pygmentize-bundled&quot;</span><span class="o">:</span> <span class="s2">&quot;^2.3.0&quot;</span><span class="p">,</span>
    <span class="s2">&quot;yargs&quot;</span><span class="o">:</span> <span class="s2">&quot;^3.7.0&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

</code></pre>
<p>You can google the depedencies I used, but basically this handles promises, md
conversion, syntax highlighting and cli options.</p>
<p>Okay and marked is installed. So at this point I decided I&#39;d start writing some
really simple commandline style scripts for blog actions and eventually wire
them together with gulp for watching markdowns, transforming and pushing branches
with gitjs.</p>
<p>But I&#39;m getting ahead of myself. Let&#39;s test some write some js code that will
generate this post and see how it looks. This is almost mind blowing.</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="err">#</span><span class="o">!</span><span class="err">/usr/bin/env node</span>
<span class="kd">var</span> <span class="nx">marked</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;marked&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">pb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;pygmentize-bundled&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">Promise</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;bluebird&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">fsp</span> <span class="o">=</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">promisifyAll</span><span class="p">(</span><span class="nx">fs</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">markedP</span> <span class="o">=</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">promisify</span><span class="p">(</span><span class="nx">marked</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">pbp</span> <span class="o">=</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">promisify</span><span class="p">(</span><span class="nx">pb</span><span class="p">);</span>


<span class="kd">function</span> <span class="nx">md2post</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">marked</span><span class="p">.</span><span class="nx">setOptions</span><span class="p">({</span>
        <span class="nx">renderer</span><span class="o">:</span> <span class="k">new</span> <span class="nx">marked</span><span class="p">.</span><span class="nx">Renderer</span><span class="p">(),</span>
        <span class="nx">gfm</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">tables</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">breaks</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">pedantic</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">sanitize</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">smartLists</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">smartypants</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">highlight</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="nx">lang</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">pbp</span><span class="p">({</span><span class="nx">lang</span><span class="o">:</span> <span class="nx">lang</span><span class="p">,</span> <span class="nx">format</span><span class="o">:</span> <span class="s1">&#39;html&#39;</span><span class="p">},</span> <span class="nx">code</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">result</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
            <span class="p">});</span> <span class="c1">//crash on reject</span>
        <span class="p">}</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">markedP</span><span class="p">(</span><span class="nx">input</span><span class="p">);</span>
<span class="p">};</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">md2post</span> <span class="o">=</span> <span class="nx">md2post</span><span class="p">;</span>


<span class="kd">function</span> <span class="nx">transform</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="nx">output</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">fsp</span><span class="p">.</span><span class="nx">readFileAsync</span><span class="p">(</span><span class="nx">input</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">rawFile</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">md2post</span><span class="p">(</span><span class="nx">rawFile</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
    <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">html</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileAsync</span><span class="p">(</span><span class="nx">output</span><span class="p">,</span> <span class="nx">html</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">transform</span> <span class="o">=</span> <span class="nx">transform</span><span class="p">;</span>


<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">module</span><span class="p">.</span><span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">argv</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;yargs&#39;</span><span class="p">).</span><span class="nx">usage</span><span class="p">(</span><span class="s1">&#39;Usage: $0 --input [path to input file] --output [path to output file]&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">demand</span><span class="p">([</span><span class="s1">&#39;input&#39;</span><span class="p">,</span> <span class="s1">&#39;output&#39;</span><span class="p">])</span>
        <span class="p">.</span><span class="nx">argv</span><span class="p">;</span>
    <span class="nx">transform</span><span class="p">(</span><span class="nx">argv</span><span class="p">.</span><span class="nx">input</span><span class="p">,</span> <span class="nx">argv</span><span class="p">.</span><span class="nx">output</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Success!&quot;</span><span class="p">);</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}).</span><span class="nx">error</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Failed:&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span>
        <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>

</code></pre>
<p>So now we have a command line util + module that will do our markdown to html transformations. Exciting.</p>
<p>A quick:</p>
<pre><code><div class="highlight"><pre><span class="o">&gt;</span> <span class="nx">chmod</span> <span class="nx">u</span><span class="o">+</span><span class="nx">x</span> <span class="nx">md2post</span><span class="p">.</span><span class="nx">js</span>
<span class="o">&gt;</span> <span class="p">.</span><span class="o">/</span><span class="nx">md2post</span><span class="p">.</span><span class="nx">js</span> <span class="o">--</span><span class="nx">input</span> <span class="nx">BuildingThisBlog</span><span class="p">.</span><span class="nx">md</span> <span class="o">--</span><span class="nx">output</span> <span class="nx">out</span><span class="p">.</span><span class="nx">html</span>
</pre></div>

</code></pre><p>Verifies that we indeed have some purty html (look familiar?):</p>
<pre><code class="lang-html"><div class="highlight"><pre><span class="nt">&lt;p&gt;</span>I immediately dug the instant-ness of github.io. Being pretty bare bones though
I was initially woo-ed by Jekyll. About a quarter of the way into the instructions
though, I found myself saying. You know what - you<span class="ni">&amp;#39;</span>ve done so little web stuff
in recent days. Why don<span class="ni">&amp;#39;</span>t you take a moment and build it out yourself?<span class="nt">&lt;/p&gt;</span>
</pre></div>

</code></pre>
<h2 id="testing">Testing</h2>
<p>To verify that we don&#39;t break things moving forward, let&#39;s be good citizens and
write some tests. For that I like mocha, which we&#39;ll add to our deps:</p>
<pre><code><div class="highlight"><pre><span class="o">&gt;</span> <span class="nx">npm</span> <span class="nx">install</span> <span class="o">-</span><span class="nx">g</span> <span class="nx">mocha</span>
</pre></div>

</code></pre><p>For our test, we&#39;ll keep it simple and only test the transform method. To do this
though we have a physical dependency on fs, which will make things hard to test.
To inject that without having to monkey around with a proper dependency injection
pattern, we&#39;ll use rewire.</p>
<pre><code><div class="highlight"><pre><span class="o">&gt;</span> <span class="nx">npm</span> <span class="nx">install</span> <span class="nx">rewire</span> <span class="o">--</span><span class="nx">save</span><span class="o">-</span><span class="nx">dev</span>
</pre></div>

</code></pre><p>Then a really simple test. We&#39;ll grab a fragment from the marked tests, since
we&#39;re not trying to verify it&#39;s ability to parse markdown, only that our code
paths work. And then we&#39;ll write a simple test that verifies promise rejection on
file input.</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">rewire</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;rewire&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">assert</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;assert&quot;</span><span class="p">)</span>

<span class="kd">var</span> <span class="nx">Promise</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;bluebird&quot;</span><span class="p">);</span>
<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;md2post&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;transforms&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;success write a file&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">done</span><span class="p">){</span>
            <span class="kd">var</span> <span class="nx">md2post</span> <span class="o">=</span> <span class="nx">rewire</span><span class="p">(</span><span class="s2">&quot;../lib/md2post.js&quot;</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">input</span> <span class="o">=</span> <span class="s2">&quot;inputfile.md&quot;</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="s2">&quot;outputfile.md&quot;</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">fsMock</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">readFileAsync</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">encoding</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span><span class="nx">r</span><span class="p">){</span>
                        <span class="nx">assert</span><span class="p">(</span><span class="nx">path</span><span class="o">===</span><span class="nx">input</span><span class="p">,</span> <span class="s2">&quot;Input path should be correct&quot;</span><span class="p">);</span>
                        <span class="nx">f</span><span class="p">(</span><span class="s2">&quot;Paragraph. &quot;</span> <span class="o">+</span>
                        <span class="s2">&quot;\n&gt; * bq Item 1 &quot;</span> <span class="o">+</span>
                        <span class="s2">&quot;\n&gt; * bq Item 2 &quot;</span> <span class="o">+</span>
                        <span class="s2">&quot;\n&gt;   * New bq Item 1 &quot;</span> <span class="o">+</span>
                        <span class="s2">&quot;\n&gt;   * New bq Item 2 &quot;</span> <span class="o">+</span>
                        <span class="s2">&quot;\n&gt;   Text here &quot;</span> <span class="o">+</span>
                        <span class="s2">&quot;\n&quot;</span> <span class="o">+</span>
                        <span class="s2">&quot;\n* * *&quot;</span><span class="p">);</span>
                    <span class="p">});</span>
                <span class="p">},</span>
                <span class="nx">writeFileAsync</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">data</span><span class="p">){</span>
                    <span class="k">return</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span><span class="nx">r</span><span class="p">){</span>
                        <span class="nx">assert</span><span class="p">(</span><span class="nx">path</span><span class="o">==</span><span class="nx">output</span><span class="p">,</span> <span class="s2">&quot;Output path should be correct&quot;</span><span class="p">);</span>
                        <span class="kd">var</span> <span class="nx">expected</span> <span class="o">=</span> <span class="s2">&quot;&lt;p&gt;Paragraph. &lt;/p&gt;\n&quot;</span> <span class="o">+</span>
                            <span class="s2">&quot;&lt;blockquote&gt;\n&quot;</span> <span class="o">+</span>
                            <span class="s2">&quot;&lt;ul&gt;\n&quot;</span> <span class="o">+</span>
                            <span class="s2">&quot;&lt;li&gt;bq Item 1 &lt;/li&gt;\n&quot;</span> <span class="o">+</span>
                            <span class="s2">&quot;&lt;li&gt;bq Item 2 &lt;ul&gt;\n&quot;</span> <span class="o">+</span>
                            <span class="s2">&quot;&lt;li&gt;New bq Item 1 &lt;/li&gt;\n&quot;</span> <span class="o">+</span>
                            <span class="s2">&quot;&lt;li&gt;New bq Item 2 \n&quot;</span> <span class="o">+</span>
                            <span class="s2">&quot;Text here &lt;/li&gt;\n&quot;</span> <span class="o">+</span>
                            <span class="s2">&quot;&lt;/ul&gt;\n&quot;</span> <span class="o">+</span>
                            <span class="s2">&quot;&lt;/li&gt;\n&quot;</span> <span class="o">+</span>
                            <span class="s2">&quot;&lt;/ul&gt;\n&quot;</span> <span class="o">+</span>
                            <span class="s2">&quot;&lt;/blockquote&gt;\n&quot;</span> <span class="o">+</span>
                            <span class="s2">&quot;&lt;hr&gt;\n&quot;</span><span class="p">;</span>

                        <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">expected</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">){</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">expected</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">!=</span> <span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">]){</span>
                                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Diff at char:&quot;</span><span class="p">,</span><span class="nx">i</span><span class="p">);</span>
                            <span class="p">}</span>
                        <span class="p">}</span>

                        <span class="nx">assert</span><span class="p">(</span><span class="nx">data</span><span class="o">===</span><span class="nx">expected</span><span class="p">,</span><span class="s2">&quot;Output should be correct&quot;</span><span class="p">);</span>
                        <span class="nx">f</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
                        <span class="nx">done</span><span class="p">();</span>
                    <span class="p">});</span>
                <span class="p">}</span>
            <span class="p">};</span>
            <span class="nx">md2post</span><span class="p">.</span><span class="nx">__set__</span><span class="p">(</span><span class="s2">&quot;fsp&quot;</span><span class="p">,</span> <span class="nx">fsMock</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">md2post</span><span class="p">.</span><span class="nx">transform</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span><span class="nx">output</span><span class="p">);</span>
        <span class="p">});</span>

        <span class="nx">it</span><span class="p">(</span><span class="s1">&#39;file failures reject properly&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">done</span><span class="p">){</span>
            <span class="kd">var</span> <span class="nx">md2post</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;../lib/md2post.js&quot;</span><span class="p">);</span> <span class="c1">//no dep stub needed</span>
            <span class="nx">md2post</span><span class="p">.</span><span class="nx">transform</span><span class="p">(</span><span class="s2">&quot;fake&quot;</span><span class="p">,</span> <span class="s2">&quot;fake&quot;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
                <span class="nx">assert</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
            <span class="p">}).</span><span class="nx">error</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">){</span>
                <span class="nx">assert</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
                <span class="nx">done</span><span class="p">();</span>
            <span class="p">})</span>
        <span class="p">});</span>
    <span class="p">})</span>
<span class="p">})</span>
</pre></div>

</code></pre>
<h2 id="the-bigger-picture">The bigger picture</h2>
<p>Okay, but now I knew I needed a way to manage posts. Some method for organizing
and indexing them. What we&#39;ll do here is follow a simple scheme of title/index.html
for post locations. Then we&#39;ll create a scheme for creating an index that we&#39;ll
use to fetch additional posts on scroll. Last we&#39;ll generate a site map and
submit it to google. After that, we&#39;ll wire up gulp command for generating
all this stuff on the fly.</p>
<p>Let&#39;s do some stuff with gulp file watchers. Now, we&#39;ll set up gulp to monitor
a posts directory for changes. When it detects one it will convert the modified
files to html and store them in a directory named for the title and index.html.</p>
<p>Doing that will give us the naming structure domain/post-title-text. Installing
gulp:</p>
<pre><code><div class="highlight"><pre><span class="nx">npm</span> <span class="nx">install</span> <span class="o">-</span><span class="nx">g</span> <span class="nx">gulp</span>
<span class="nx">npm</span> <span class="nx">install</span> <span class="nx">gulp</span> <span class="o">--</span><span class="nx">save</span><span class="o">-</span><span class="nx">dev</span>
</pre></div>

</code></pre><p>Next, we&#39;ll create a basic gulp file watch and watch our &quot;raws&quot; directory which
will contain raw mds. We&#39;ll also watch lib and test and cause modifications
there to trigger mocha. For this we&#39;ll use gulp.watch and gulp-mocha.</p>
<pre><code><div class="highlight"><pre><span class="nx">npm</span> <span class="nx">install</span> <span class="nx">gulp</span><span class="o">-</span><span class="nx">mocha</span> <span class="o">--</span><span class="nx">save</span><span class="o">-</span><span class="nx">dev</span>
</pre></div>

</code></pre><p>Our initial skeleton GulpFile.js looks like:</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">gulp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">watch</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp-watch&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">batch</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp-batch&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">mocha</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp-mocha&#39;</span><span class="p">);</span>

<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Testing!&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;build_content&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Building!&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">watch</span><span class="p">(</span><span class="s1">&#39;lib/**/*.js&#39;</span><span class="p">,</span> <span class="nx">batch</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">gulp</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">);</span>
    <span class="p">}));</span>

    <span class="nx">watch</span><span class="p">(</span><span class="s1">&#39;tests/**/*.js&#39;</span><span class="p">,</span> <span class="nx">batch</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">gulp</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">);</span>
    <span class="p">}));</span>

    <span class="nx">watch</span><span class="p">(</span><span class="s1">&#39;raws/**/*.md&#39;</span><span class="p">,</span> <span class="nx">batch</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">gulp</span><span class="p">.</span><span class="nx">start</span><span class="p">(</span><span class="s1">&#39;build_content&#39;</span><span class="p">);</span>
    <span class="p">}));</span>
<span class="p">});</span>
</pre></div>

</code></pre>
<p>We can edit raws and lib to verify we see the correct console output. But,
we need some real code in there to do some real stuff. Wiring tests is easy well
use the gulp-mocha plugin and use gulp.watch to trigger it off of changes to
our lib or tests directory.</p>
<p>For building content, we&#39;ll need another target command that will leverage
md2post.js. Streams hurt my head and I find them opaque but I suppose there is
no arguing the hard performance benefits. To get around my personal brain power
limitations I&#39;m going to use through2 which allows me think in terms of
functional blocks but still get the benefit of streaming.</p>
<p>Here, we&#39;ll create a function called processMdFiles that will get passed to
through2 and used in our &quot;build_content&quot; task. The function cheats a bit,
operates converts the buffer from our vinyl file to a string, transforms and
then rebuffers it. As a later project we&#39;ll see if we can get marked working
with streams. I suppose we should have looked or written a gulp-marked plugin,
but this will suffice for now.</p>
<p>Our final gulp file looks like:</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">gulp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">mocha</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp-mocha&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">tap</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp-tap&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">rename</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;gulp-rename&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">through2</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;through2&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">md2post</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./lib/md2post.js&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>


<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="s1">&#39;tests/**/*.js&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">read</span><span class="o">:</span> <span class="kc">false</span><span class="p">})</span>
        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">mocha</span><span class="p">({</span><span class="nx">reporter</span><span class="o">:</span> <span class="s1">&#39;nyan&#39;</span><span class="p">}));</span>
<span class="p">});</span>

<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;build_content&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="s1">&#39;raws/**/*.md&#39;</span><span class="p">)</span>
        <span class="c1">// tap into the stream to get each file&#39;s data</span>
        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">through2</span><span class="p">.</span><span class="nx">obj</span><span class="p">(</span><span class="nx">processMdFiles</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="s2">&quot;./dist&quot;</span><span class="p">))</span>
<span class="p">});</span>


<span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">gulp</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="s1">&#39;lib/**/*.js&#39;</span><span class="p">,[</span><span class="s1">&#39;test&#39;</span><span class="p">]);</span>
    <span class="nx">gulp</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="s1">&#39;tests/**/*.js&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]);</span>
    <span class="nx">gulp</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span><span class="s1">&#39;raws/**/*.md&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;build_content&#39;</span><span class="p">]);</span>
<span class="p">});</span>

<span class="kd">function</span> <span class="nx">processMdFiles</span><span class="p">(</span><span class="nx">chunk</span><span class="p">,</span> <span class="nx">enc</span><span class="p">,</span> <span class="nx">cb</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nx">md2post</span><span class="p">(</span><span class="nx">chunk</span><span class="p">.</span><span class="nx">contents</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
    <span class="nx">promise</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">){</span>
        <span class="kd">var</span> <span class="nx">filePath</span> <span class="o">=</span> <span class="nx">chunk</span><span class="p">.</span><span class="nx">path</span><span class="p">;</span>
        <span class="nx">chunk</span><span class="p">.</span><span class="nx">contents</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Buffer</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">chunk</span><span class="p">);</span>
        <span class="nx">cb</span><span class="p">();</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

<span class="p">}</span>
</pre></div>

</code></pre>
<p>Now, as I save this blog post, an equivalent file is written to ./dist but is
formatted with html. This is cool, but I don&#39;t want
to write to ./dist/filename.md. I actually want to take the post name, create a directory
and then inside place an index.html file. After that I&#39;ll need to start thinking
about the main index and what our blog template will look like.</p>
<p>Gulp-rename passed a function lets us do the path swap pretty easily. Our
build_content task turns into:</p>
<pre><code><div class="highlight"><pre><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;build_content&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="s1">&#39;raws/**/*.md&#39;</span><span class="p">)</span>
        <span class="c1">// tap into the stream to get each file&#39;s data</span>
        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">through2</span><span class="p">.</span><span class="nx">obj</span><span class="p">(</span><span class="nx">processMdFiles</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">rename</span><span class="p">(</span><span class="nx">newPath</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="s2">&quot;./dist&quot;</span><span class="p">))</span>
<span class="p">});</span>

<span class="nx">With</span> <span class="k">this</span> <span class="kd">function</span> <span class="nx">handling</span> <span class="nx">the</span> <span class="nx">rename</span> <span class="nx">details</span><span class="o">:</span>
</pre></div>

</code></pre><p>function newPath(pathObj) {
    pathObj.dirname = path.join(pathObj.dirname, pathObj.basename)
    pathObj.basename = &quot;index&quot;;
    pathObj.extname = &quot;.html&quot;;
}</p>
<pre><code><div class="highlight"><pre><span class="err">##</span> <span class="nx">The</span> <span class="nx">even</span> <span class="nx">bigger</span> <span class="nx">picture</span>

<span class="nx">Next</span> <span class="nx">up</span> <span class="nx">I</span> <span class="nx">needed</span> <span class="nx">to</span> <span class="nx">figure</span> <span class="nx">out</span> <span class="nx">what</span> <span class="nx">I</span> <span class="nx">wanted</span> <span class="nx">to</span> <span class="k">do</span> <span class="nx">about</span> <span class="nx">an</span> <span class="nx">index</span><span class="p">.</span> <span class="nx">I</span> <span class="nx">didn</span><span class="s1">&#39;t know</span>
<span class="s1">much about SEO or blogging in general, but I knew I needed some way for posts to</span>
<span class="s1">get ingested. I also knew I wanted to easily be able to submit a post to twitter,</span>
<span class="s1">fb, hacker news and the like. I also wanted a pretty single page app experience.</span>
<span class="s1">How would I go about getting both? I needed to look at a real world example to</span>
<span class="s1">make sure I was going about this the right way.</span>

<span class="s1">After some thought I decided I would organize posts into numeric txt files in groups of</span>
<span class="s1">10. I&#39;</span><span class="nx">d</span> <span class="nx">have</span> <span class="nx">a</span> <span class="nx">main</span> <span class="nx">template</span> <span class="nx">which</span> <span class="nx">would</span> <span class="nx">get</span> <span class="nx">updated</span> <span class="kd">with</span> <span class="nx">the</span> <span class="s2">&quot;latest&quot;</span> <span class="nx">group</span> <span class="nx">of</span> <span class="mi">10</span><span class="p">.</span> <span class="nx">But</span>
<span class="nx">as</span> <span class="nx">you</span> <span class="nx">scrolled</span> <span class="nx">it</span> <span class="nx">would</span> <span class="nx">grab</span> <span class="nx">the</span> <span class="nx">next</span> <span class="nx">group</span> <span class="nx">of</span> <span class="mi">10</span> <span class="nx">and</span> <span class="nx">their</span> <span class="nx">associated</span> <span class="nx">snippets</span><span class="p">.</span>

<span class="nx">Things</span> <span class="nx">just</span> <span class="nx">got</span> <span class="nx">more</span> <span class="nx">complex</span><span class="p">.</span> <span class="nx">Before</span> <span class="nx">I</span> <span class="nx">started</span> <span class="nx">automating</span> <span class="nx">all</span> <span class="nx">of</span> <span class="k">this</span> <span class="kd">with</span> <span class="nx">gulp</span><span class="p">,</span> <span class="nx">I</span> <span class="nx">really</span>
<span class="nx">needed</span> <span class="nx">to</span> <span class="nx">lock</span> <span class="nx">down</span> <span class="nx">some</span> <span class="nx">client</span> <span class="nx">code</span> <span class="nx">to</span> <span class="nx">make</span> <span class="nx">sure</span> <span class="nx">it</span> <span class="nx">was</span> <span class="k">in</span> <span class="nx">fact</span> <span class="nx">what</span> <span class="nx">I</span> <span class="nx">wanted</span><span class="p">.</span> <span class="nx">At</span> <span class="k">this</span> <span class="nx">point</span><span class="p">,</span>
<span class="nx">my</span> <span class="nx">knee</span> <span class="nx">jerk</span> <span class="nx">reaction</span> <span class="nx">said</span> <span class="o">-</span> <span class="nx">hey</span> <span class="k">this</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">great</span> <span class="nx">time</span> <span class="nx">to</span> <span class="nx">checkout</span> <span class="nx">react</span><span class="p">.</span> <span class="nx">And</span> <span class="nx">so</span> <span class="nx">I</span> <span class="nx">did</span><span class="p">.</span>

<span class="err">##</span> <span class="nx">Taking</span> <span class="nx">some</span> <span class="nx">time</span> <span class="nx">to</span> <span class="nx">think</span> <span class="nx">about</span> <span class="nx">the</span> <span class="nx">experience</span> <span class="kd">with</span> <span class="nx">ReactJS</span><span class="p">.</span>

<span class="nx">Everything</span> <span class="k">in</span> <span class="nx">React</span> <span class="nx">is</span> <span class="nx">components</span><span class="p">.</span> <span class="nx">Which</span> <span class="nx">I</span> <span class="nx">like</span><span class="p">.</span> <span class="nx">So</span> <span class="nx">now</span> <span class="kd">let</span><span class="s1">&#39;s take a moment to think through</span>
<span class="s1">what components this blog will have. My initial thoughts looked like this:</span>

<span class="s1">* Main Scroll List of Posts - displays N post summaries at a time and lets us scroll through and load more on scroll end</span>
<span class="s1">* Post Summary Card</span>
<span class="s1">** Title</span>
<span class="s1">** Snippet</span>
<span class="s1">* Full Post View (this should be a single page)</span>
<span class="s1">** Title</span>
<span class="s1">** Body</span>
<span class="s1">* Tweets side bar</span>
<span class="s1">** Tweet</span>
<span class="s1">* Instapaper side bar</span>
<span class="s1">** Headline</span>

<span class="s1">That seems pretty easy. For Models, we&#39;</span><span class="nx">ll</span> <span class="nx">likely</span> <span class="nx">use</span> <span class="nx">Backbone</span> <span class="nx">and</span> <span class="nx">potentially</span> <span class="nx">some</span> <span class="nx">Browserify</span>
<span class="nx">because</span> <span class="nx">I</span> <span class="nx">like</span> <span class="nx">my</span> <span class="nx">js</span> <span class="nx">node</span><span class="o">-</span><span class="nx">like</span><span class="p">.</span> <span class="nx">Quick</span> <span class="nx">shout</span> <span class="nx">out</span> <span class="nx">to</span> <span class="p">(</span><span class="nx">Tyler</span> <span class="nx">McGinnis</span><span class="p">)[</span><span class="nx">http</span><span class="o">:</span><span class="c1">//tylermcginnis.com/] who wrote</span>
<span class="p">(</span><span class="k">this</span><span class="p">)[</span><span class="nx">http</span><span class="o">:</span><span class="c1">//tylermcginnis.com/reactjs-tutorial-a-comprehensive-guide-to-building-apps-with-react/] very</span>
<span class="nx">awesome</span> <span class="nx">tutorial</span> <span class="nx">on</span> <span class="nx">React</span> <span class="nx">which</span> <span class="nx">I</span> <span class="nx">used</span> <span class="nx">to</span> <span class="nx">accumulate</span> <span class="nx">my</span> <span class="nx">current</span> <span class="p">(</span><span class="nx">paltry</span><span class="p">)</span> <span class="nx">knowledge</span><span class="p">.</span> <span class="nx">Bear</span> <span class="k">in</span> <span class="nx">mind</span> <span class="nx">I</span> <span class="nx">haven</span><span class="s1">&#39;t</span>
<span class="s1">done anything in the web front-end world in a while so bear with me.</span>

<span class="s1">## Flexing</span>

<span class="s1">I&#39;</span><span class="nx">ve</span> <span class="nx">never</span> <span class="nx">really</span> <span class="nx">loved</span> <span class="nx">css</span> <span class="nx">layouts</span><span class="p">.</span> <span class="nx">I</span> <span class="nx">don</span><span class="err">&#39;</span><span class="nx">t</span> <span class="nx">think</span> <span class="nx">anyone</span> <span class="nx">ever</span> <span class="nx">has</span><span class="p">.</span> <span class="nx">That</span> <span class="nx">said</span><span class="p">,</span> <span class="nx">flexbox</span> <span class="nx">is</span> <span class="k">finally</span> <span class="nx">a</span> <span class="nx">css</span> <span class="nx">layout</span>
<span class="nx">scheme</span> <span class="nx">I</span> <span class="nx">can</span> <span class="nx">both</span> <span class="nx">grok</span> <span class="nx">and</span> <span class="nx">get</span> <span class="nx">behind</span><span class="p">.</span> <span class="nx">So</span><span class="p">,</span> <span class="nx">given</span> <span class="nx">the</span> <span class="nx">layout</span> <span class="nx">above</span><span class="p">,</span> <span class="nx">I</span> <span class="nx">came</span> <span class="nx">up</span> <span class="kd">with</span> <span class="nx">the</span> <span class="nx">following</span> <span class="nx">flexbox</span> <span class="nx">layout</span>
<span class="nx">using</span> <span class="nx">node</span> <span class="nx">sass</span> <span class="nx">compiled</span> <span class="nx">it</span> <span class="nx">down</span> <span class="nx">to</span> <span class="nx">a</span> <span class="nx">template</span><span class="p">.</span>

<span class="err">```</span><span class="nx">css</span>
<span class="p">}</span>
</pre></div>

</code></pre><p>With a really basic html skeleton:</p>
<pre><code class="lang-html"><div class="highlight"><pre>```

## MOAR AUTOMATING OF THE THINGS

This let me see that I had the basic blocks I was looking for. After fiddling
with this a bit I decided I needed to extend my gulp file to handle some of the
repetitive tasks I&#39;d been dealing with. As I worked on the sass + html, I found
myself constantly forgetting to compile + refresh my workspace. So, I decided
to take care of that and extended my gulp file with a new watch and auto-reload
express web app and gulp-sass for compilation. This was also a much needed break
from fiddling with CSS properties. :/

To do this we do some new installs:
</pre></div>

</code></pre>
<p>npm install express --save-dev</p>
<pre><code><div class="highlight"><pre><span class="nx">Express</span> <span class="nx">will</span> <span class="nx">be</span> <span class="nx">our</span> <span class="nx">web</span> <span class="nx">framework</span><span class="p">.</span> <span class="nx">We</span><span class="err">&#39;</span><span class="nx">ll</span> <span class="nx">write</span> <span class="nx">it</span> <span class="nx">up</span> <span class="nx">as</span> <span class="nx">part</span> <span class="nx">of</span> <span class="nx">our</span> <span class="k">default</span> <span class="nx">task</span>
<span class="nx">and</span> <span class="nx">have</span> <span class="nx">it</span> <span class="nx">serve</span> <span class="nx">our</span> <span class="p">.</span><span class="o">/</span><span class="nx">dist</span> <span class="nx">directory</span> <span class="nx">and</span> <span class="nx">also</span> <span class="nx">make</span> <span class="nx">it</span> <span class="nx">a</span> <span class="nx">pre</span><span class="o">-</span><span class="nx">req</span> <span class="k">for</span> <span class="nx">our</span> <span class="k">default</span>
<span class="nx">task</span><span class="p">.</span>
</pre></div>

</code></pre><p>gulp.task(&#39;default&#39;, [&#39;express&#39;], function () {
    gulp.watch(&#39;lib/<strong>/*.js&#39;,[&#39;test&#39;]);
    gulp.watch(&#39;tests/</strong>/<em>.js&#39;, [&#39;test&#39;]);
    gulp.watch(&#39;raws/**/</em>.md&#39;, [&#39;build_content&#39;]);
    gulp.watch(&#39;template/<strong>/*.scss&#39;, [&#39;compile_sass&#39;]);
    gulp.watch(&#39;template/</strong>/<em>.</em>&#39;, [&#39;reload&#39;]);
});</p>
<p>gulp.task(&#39;express&#39;, function() {
    var express = require(&#39;express&#39;);
    var app = express();
    app.use(express.static(&#39;./dist&#39;));
    app.listen(8000);
});</p>
<pre><code><div class="highlight"><pre><span class="nx">Now</span> <span class="k">if</span> <span class="nx">I</span> <span class="nx">navigate</span> <span class="nx">to</span> <span class="nx">http</span><span class="o">:</span><span class="c1">//localhost:8000/buildingthisblog I see the latest</span>
<span class="nx">transformed</span> <span class="nx">post</span> <span class="nx">via</span> <span class="nx">index</span><span class="p">.</span><span class="nx">html</span><span class="p">.</span> <span class="nx">Cool</span><span class="p">.</span> <span class="nx">But</span> <span class="nx">now</span> <span class="nx">I</span> <span class="nx">need</span> <span class="nx">some</span> <span class="nx">more</span> <span class="nx">watchers</span> <span class="nx">and</span>
<span class="nx">I</span> <span class="nx">need</span> <span class="nx">the</span> <span class="nx">site</span> <span class="nx">to</span> <span class="nx">auto</span> <span class="nx">reload</span> <span class="nx">anytime</span> <span class="nx">I</span> <span class="nx">modify</span> <span class="nx">stuff</span><span class="p">.</span>

<span class="nx">For</span> <span class="k">this</span> <span class="nx">we</span><span class="err">&#39;</span><span class="nx">ll</span> <span class="nx">need</span> <span class="nx">livereload</span> <span class="nx">and</span> <span class="nx">tinylr</span><span class="p">.</span> <span class="nx">Which</span> <span class="nx">we</span> <span class="nx">can</span> <span class="nx">also</span> <span class="nx">install</span><span class="o">:</span>
</pre></div>

</code></pre><p>npm install connect-livereload tiny-lr gulp-livereload --save-dev</p>
<pre><code><div class="highlight"><pre><span class="nx">We</span><span class="s1">&#39;ll add these to our gulpfile:</span>
<span class="s1">```javascript</span>
<span class="s1">var livereload = require(&#39;</span><span class="nx">connect</span><span class="o">-</span><span class="nx">livereload</span><span class="s1">&#39;)</span>
<span class="s1">var livereloadport = 35729;</span>
<span class="s1">var lrserver = require(&#39;</span><span class="nx">tiny</span><span class="o">-</span><span class="nx">lr</span><span class="err">&#39;</span><span class="p">)(),</span>
</pre></div>

</code></pre><p>From there, we can take a <code>.pipe(refresh(lrserver));</code> whenever we want to
refresh. I just put it to the test...whoohoo.</p>
<h2 id="even-moar-au-tomatoe-ing-">EVEN MOAR AU-TOMATOE-ING!</h2>
<p>That solves reload issue but I need it for sass + css. Easy enough. gulp-sass and
a new task.</p>
<p>Install:</p>
<pre><code><div class="highlight"><pre><span class="nx">npm</span> <span class="nx">install</span> <span class="o">--</span><span class="nx">save</span><span class="o">-</span><span class="nx">dev</span> <span class="nx">gulp</span><span class="o">-</span><span class="nx">sass</span>
</pre></div>

</code></pre><p>Add to gulpfile:</p>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">&#39;sass&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="s1">&#39;./template/*.scss&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">sass</span><span class="p">())</span>
        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="s1">&#39;./dist&#39;</span><span class="p">));</span>
<span class="p">});</span>
</pre></div>

</code></pre>
